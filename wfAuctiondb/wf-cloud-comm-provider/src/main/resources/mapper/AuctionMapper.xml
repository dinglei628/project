<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zb.mapper.AuctionMapper">
    <insert id="addComm" parameterType="com.zb.entity.Auction">
            INSERT INTO auctiondbcomm.auction
	(
	auctionName,
	auctionStartPrice,
	auctionUpset,
	auctionStartTime,
	auctionEndTime,
	auctionPic,
	auctionDesc
	)
	VALUES
	(
	#{auctionName},
	#{auctionStartPrice},
	#{auctionUpset},
	#{auctionStartTime},
	#{auctionEndTime},
	#{auctionPic},
	#{auctionDesc}
	);
    </insert>

    <update id="updateComm" parameterType="int">
        UPDATE auctiondbcomm.auction
	SET
	auctionName = #{auctionName} ,
	auctionStartPrice = #{auctionStartPrice} ,
	auctionUpset = #{auctionUpset} ,
	auctionStartTime = #{auctionStartTime} ,
	auctionEndTime = #{auctionEndTime} ,
	auctionPic = #{auctionPic} ,
	auctionDesc = #{auctionDesc}
	WHERE
	auctionId = #{auctionId} ;
    </update>

	<select id="selAuction" resultType="com.zb.entity.Auction">
		SELECT 	* FROM auctiondbcomm.auction WHERE 1=1
		<if test="auctionName != null and auctionName != ''">
			AND auctionName LIKE CONCAT(#{auctionName},'%')
		</if>
		<if test="auctionDesc != null and auctionDesc != ''">
			AND auctionDesc LIKE CONCAT(#{auctionDesc},'%')
		</if>
		<if test="auctionStartTime != null and auctionStartTime != ''">
			AND auctionStartTime LIKE CONCAT(#{auctionStartTime},'%')
		</if>
		<if test="auctionEndTime != null and auctionEndTime != ''">
			AND auctionEndTime LIKE CONCAT(#{auctionEndTime},'%')
		</if>
		<if test="auctionStartPrice != 0 and auctionStartPrice != null">
			AND auctionStartPrice = #{auctionStartPrice}
		</if>
		LIMIT #{from}, #{pageSize};
	</select>

	<select id="selAuctionCount" resultType="int">
		SELECT 	count(1) FROM auctiondbcomm.auction WHERE 1=1
		<if test="auctionName != null and auctionName != ''">
			AND auctionName LIKE CONCAT(#{auctionName},'%')
		</if>
		<if test="auctionDesc != null and auctionDesc != ''">
			AND auctionDesc LIKE CONCAT(#{auctionDesc},'%')
		</if>
		<if test="auctionStartTime != null and auctionStartTime != ''">
			AND auctionStartTime LIKE CONCAT(#{auctionStartTime},'%')
		</if>
		<if test="auctionEndTime != null and auctionEndTime != ''">
			AND auctionEndTime LIKE CONCAT(#{auctionEndTime},'%')
		</if>
		<if test="auctionStartPrice != 0 and auctionStartPrice != null">
			AND auctionStartPrice = #{auctionStartPrice}
		</if>
	</select>


	<delete id="delComm" parameterType="int">
		delete from auction where auctionId = #{auctionId}
	</delete>

	<select id="selCommById" resultType="com.zb.entity.Auction">
		select * from auction where auctionId = #{auctionId}
	</select>

	<insert id="addAuctionrecord" parameterType="com.zb.entity.Auctionrecord">
		INSERT INTO auctiondbcomm.auctionrecord
	(
	userId,
	auctionId,
	auctionTime,
	auctionPrice
	)
	VALUES
	(
	#{userId},
	#{auctionId},
	now(),
	#{auctionPrice}
	);
	</insert>

	<select id="selRecord" resultType="com.zb.entity.Auctionrecord">
		select * from Auctionrecord where auctionId=#{auctionId}
	</select>

	<select id="getAuction" resultType="com.zb.entity.Auction">
		SELECT * FROM auction
	</select>

</mapper>